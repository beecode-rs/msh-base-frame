import { arrayUtil } from '@beecode/msh-util/array-util';
import { promises as fs } from 'fs';
import { copy } from 'fs-extra/esm';
import { glob } from 'glob';
import { logger } from '#src/util/logger';
export class FileAdapter {
    async copy(params) {
        const { sourceFilePath, destinationFilePath, options: { ignoreList } = { ignoreList: [] } } = params;
        const copyContentList = await glob('**/*', {
            cwd: sourceFilePath,
            dot: true,
            ignore: ignoreList,
            nodir: true,
        });
        await Promise.all(copyContentList.map(async (file) => {
            await copy(`${sourceFilePath}/${file}`, `${destinationFilePath}/${file}`);
        }));
    }
    async copyFilesIfNotExists(params) {
        const { sourceFilePath, destinationFilePath } = params;
        await copy(sourceFilePath, destinationFilePath, { errorOnExist: true, overwrite: false });
    }
    async copyAndOverride(params) {
        const { sourceFilePath, destinationFilePath } = params;
        await copy(sourceFilePath, destinationFilePath, { errorOnExist: false, overwrite: true });
    }
    async filterFiles(params) {
        const { fileFolderPathList } = params;
        const filtered = await Promise.all(fileFolderPathList.map(async (fileFolderPath) => {
            if (await this.isFile({ filePath: fileFolderPath })) {
                return fileFolderPath;
            }
            return undefined;
        }));
        return filtered.filter(arrayUtil.notEmpty);
    }
    async getFolderContent(params) {
        const { folderPath } = params;
        return fs.readdir(folderPath);
    }
    async getRecurringFolderContent(params) {
        const { folderPath } = params;
        if (!(await this.isDirectory({ folderPath }))) {
            return [];
        }
        const folderContent = (await this.getFolderContent({ folderPath })).map((folderContentPath) => {
            return `${folderPath}/${folderContentPath}`;
        });
        const subFolderContents = await Promise.all(folderContent.map((folderContentPath) => {
            return this.getRecurringFolderContent({ folderPath: folderContentPath });
        }));
        return [...folderContent, ...subFolderContents.flat()];
    }
    async isDirectory(params) {
        const { folderPath } = params;
        try {
            const stat = await fs.stat(folderPath);
            return stat.isDirectory();
        }
        catch (error) {
            logger().error('FileClient.isDirectory', { error });
            return false;
        }
    }
    async isFile(params) {
        const { filePath } = params;
        try {
            const stat = await fs.stat(filePath);
            return stat.isFile();
        }
        catch (error) {
            logger().error('FileClient.isFile', { error });
            return false;
        }
    }
    async makeFolderIfNotExist(params) {
        const { folderPath } = params;
        if (await fs.stat(folderPath).catch(() => false)) {
            return;
        }
        return fs.mkdir(folderPath);
    }
    async readFile(params) {
        const { filePath } = params;
        return fs.readFile(filePath, { encoding: 'utf-8' });
    }
    async removeFile(params) {
        const { filePath } = params;
        if (!(await fs.stat(filePath).catch(() => false))) {
            return;
        }
        return fs.rm(filePath);
    }
    async removeFolder(params) {
        const { folderPath } = params;
        if (!(await fs.stat(folderPath).catch(() => false))) {
            return;
        }
        return fs.rm(folderPath, { force: true, recursive: true });
    }
    writeToFile(params) {
        const { filePath, fileContent } = params;
        return fs.writeFile(filePath, fileContent, 'utf-8');
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmlsZS1hZGFwdGVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL2xpYi9maWxlLWFkYXB0ZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLDhCQUE4QixDQUFBO0FBQ3hELE9BQU8sRUFBRSxRQUFRLElBQUksRUFBRSxFQUFFLE1BQU0sSUFBSSxDQUFBO0FBQ25DLE9BQU8sRUFBRSxJQUFJLEVBQUUsTUFBTSxjQUFjLENBQUE7QUFDbkMsT0FBTyxFQUFFLElBQUksRUFBRSxNQUFNLE1BQU0sQ0FBQTtBQUUzQixPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0sa0JBQWtCLENBQUE7QUFFekMsTUFBTSxPQUFPLFdBQVc7SUFDdkIsS0FBSyxDQUFDLElBQUksQ0FBQyxNQUFtRztRQUM3RyxNQUFNLEVBQUUsY0FBYyxFQUFFLG1CQUFtQixFQUFFLE9BQU8sRUFBRSxFQUFFLFVBQVUsRUFBRSxHQUFHLEVBQUUsVUFBVSxFQUFFLEVBQUUsRUFBRSxFQUFFLEdBQUcsTUFBTSxDQUFBO1FBRXBHLE1BQU0sZUFBZSxHQUFHLE1BQU0sSUFBSSxDQUFDLE1BQU0sRUFBRTtZQUMxQyxHQUFHLEVBQUUsY0FBYztZQUNuQixHQUFHLEVBQUUsSUFBSTtZQUNULE1BQU0sRUFBRSxVQUFVO1lBQ2xCLEtBQUssRUFBRSxJQUFJO1NBQ1gsQ0FBQyxDQUFBO1FBRUYsTUFBTSxPQUFPLENBQUMsR0FBRyxDQUNoQixlQUFlLENBQUMsR0FBRyxDQUFDLEtBQUssRUFBRSxJQUFZLEVBQUUsRUFBRTtZQUMxQyxNQUFNLElBQUksQ0FBQyxHQUFHLGNBQWMsSUFBSSxJQUFJLEVBQUUsRUFBRSxHQUFHLG1CQUFtQixJQUFJLElBQUksRUFBRSxDQUFDLENBQUE7UUFDMUUsQ0FBQyxDQUFDLENBQ0YsQ0FBQTtJQUNGLENBQUM7SUFFRCxLQUFLLENBQUMsb0JBQW9CLENBQUMsTUFBK0Q7UUFDekYsTUFBTSxFQUFFLGNB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RSxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUUsQ0FBQztZQUNuRCxPQUFNO1FBQ1AsQ0FBQztRQUVELE9BQU8sRUFBRSxDQUFDLEVBQUUsQ0FBQyxRQUFRLENBQUMsQ0FBQTtJQUN2QixDQUFDO0lBRUQsS0FBSyxDQUFDLFlBQVksQ0FBQyxNQUE4QjtRQUNoRCxNQUFNLEVBQUUsVUFBVSxFQUFFLEdBQUcsTUFBTSxDQUFBO1FBRTdCLElBQUksQ0FBQyxDQUFDLE1BQU0sRUFBRSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQyxLQUFLLENBQUMsR0FBRyxFQUFFLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRSxDQUFDO1lBQ3JELE9BQU07UUFDUCxDQUFDO1FBRUQsT0FBTyxFQUFFLENBQUMsRUFBRSxDQUFDLFVBQVUsRUFBRSxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsU0FBUyxFQUFFLElBQUksRUFBRSxDQUFDLENBQUE7SUFDM0QsQ0FBQztJQUVELFdBQVcsQ0FBQyxNQUFpRDtRQUM1RCxNQUFNLEVBQUUsUUFBUSxFQUFFLFdBQVcsRUFBRSxHQUFHLE1BQU0sQ0FBQTtRQUV4QyxPQUFPLEVBQUUsQ0FBQyxTQUFTLENBQUMsUUFBUSxFQUFFLFdBQVcsRUFBRSxPQUFPLENBQUMsQ0FBQTtJQUNwRCxDQUFDO0NBQ0QiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBhcnJheVV0aWwgfSBmcm9tICdAYmVlY29kZS9tc2gtdXRpbC9hcnJheS11dGlsJ1xuaW1wb3J0IHsgcHJvbWlzZXMgYXMgZnMgfSBmcm9tICdmcydcbmltcG9ydCB7IGNvcHkgfSBmcm9tICdmcy1leHRyYS9lc20nXG5pbXBvcnQgeyBnbG9iIH0gZnJvbSAnZ2xvYidcblxuaW1wb3J0IHsgbG9nZ2VyIH0gZnJvbSAnI3NyYy91dGlsL2xvZ2dlcidcblxuZXhwb3J0IGNsYXNzIEZpbGVBZGFwdGVyIHtcblx0YXN5bmMgY29weShwYXJhbXM6IHsgc291cmNlRmlsZVBhdGg6IHN0cmluZzsgZGVzdGluYXRpb25GaWxlUGF0aDogc3RyaW5nOyBvcHRpb25zPzogeyBpZ25vcmVMaXN0OiBzdHJpbmdbXSB9IH0pOiBQcm9taXNlPHZvaWQ+IHtcblx0XHRjb25zdCB7IHNvdXJjZUZpbGVQYXRoLCBkZXN0aW5hdGlvbkZpbGVQYXRoLCBvcHRpb25zOiB7IGlnbm9yZUxpc3QgfSA9IHsgaWdub3JlTGlzdDogW10gfSB9ID0gcGFyYW1zXG5cblx0XHRjb25zdCBjb3B5Q29udGVudExpc3QgPSBhd2FpdCBnbG9iKCcqKi8qJywge1xuXHRcdFx0Y3dkOiBzb3VyY2VGaWxlUGF0aCxcblx0XHRcdGRvdDogdHJ1ZSxcblx0XHRcdGlnbm9yZTogaWdub3JlTGlzdCxcblx0XHRcdG5vZGlyOiB0cnVlLFxuXHRcdH0pXG5cblx0XHRhd2FpdCBQcm9taXNlLmFsbChcblx0XHRcdGNvcHlDb250ZW50TGlzdC5tYXAoYXN5bmMgKGZpbGU6IHN0cmluZykgPT4ge1xuXHRcdFx0XHRhd2FpdCBjb3B5KGAke3NvdXJjZUZpbGVQYXRofS8ke2ZpbGV9YCwgYCR7ZGVzdGluYXRpb25GaWxlUGF0aH0vJHtmaWxlfWApXG5cdFx0XHR9KVxuXHRcdClcblx0fVxuXG5cdGFzeW5jIGNvcHlGaWxlc0lmTm90RXhpc3RzKHBhcmFtczogeyBzb3VyY2VGaWxlUGF0aDogc3RyaW5nOyBkZXN0aW5hdGlvbkZpbGVQYXRoOiBzdHJpbmcgfSk6IFByb21pc2U8dm9pZD4ge1xuXHRcdGNvbnN0IHsgc291cmNlRmlsZVBhdGgsIGRlc3RpbmF0aW9uRmlsZVBhdGggfSA9IHBhcmFtc1xuXG5cdFx0YXdhaXQgY29weShzb3VyY2VGaWxlUGF0aCwgZGVzdGluYXRpb25GaWxlUGF0aCwgeyBlcnJvck9uRXhpc3Q6IHRydWUsIG92ZXJ3cml0ZTogZmFsc2UgfSlcblx0fVxuXG5cdGFzeW5jIGNvcHlBbmRPdmVycmlkZShwYXJhbXM6IHsgc291cmNlRmlsZVBhdGg6IHN0cmluZzsgZGVzdGluYXRpb25GaWxlUGF0aDogc3RyaW5nIH0pOiBQcm9taXNlPHZvaWQ+IHtcblx0XHRjb25zdCB7IHNvdXJjZUZpbGVQYXRoLCBkZXN0aW5hdGlvbkZpbGVQYXRoIH0gPSBwYXJhbXNcblxuXHRcdGF3YWl0IGNvcHkoc291cmNlRmlsZVBhdGgsIGRlc3RpbmF0aW9uRmlsZVBhdGgsIHsgZXJyb3JPbkV4aXN0OiBmYWxzZSwgb3ZlcndyaXRlOiB0cnVlIH0pXG5cdH1cblxuXHRhc3luYyBmaWx0ZXJGaWxlcyhwYXJhbXM6IHsgZmlsZUZvbGRlclBhdGhMaXN0OiBzdHJpbmdbXSB9KTogUHJvbWlzZTxzdHJpbmdbXT4ge1xuXHRcdGNvbnN0IHsgZmlsZUZvbGRlclBhdGhMaXN0IH0gPSBwYXJhbXNcblxuXHRcdGNvbnN0IGZpbHRlcmVkID0gYXdhaXQgUHJvbWlzZS5hbGwoXG5cdFx0XHRmaWxlRm9sZGVyUGF0aExpc3QubWFwKGFzeW5jIChmaWxlRm9sZGVyUGF0aCkgPT4ge1xuXHRcdFx0XHRpZiAoYXdhaXQgdGhpcy5pc0ZpbGUoeyBmaWxlUGF0aDogZmlsZUZvbGRlclBhdGggfSkpIHtcblx0XHRcdFx0XHRyZXR1cm4gZmlsZUZvbGRlclBhdGhcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiB1bmRlZmluZWRcblx0XHRcdH0pXG5cdFx0KVxuXG5cdFx0cmV0dXJuIGZpbHRlcmVkLmZpbHRlcihhcnJheVV0aWwubm90RW1wdHkpXG5cdH1cblxuXHRhc3luYyBnZXRGb2xkZXJDb250ZW50KHBhcmFtczogeyBmb2xkZXJQYXRoOiBzdHJpbmcgfSk6IFByb21pc2U8c3RyaW5nW10+IHtcblx0XHRjb25zdCB7IGZvbGRlclBhdGggfSA9IHBhcmFtc1xuXG5cdFx0cmV0dXJuIGZzLnJlYWRkaXIoZm9sZGVyUGF0aClcblx0fVxuXG5cdGFzeW5jIGdldFJlY3VycmluZ0ZvbGRlckNvbnRlbnQocGFyYW1zOiB7IGZvbGRlclBhdGg6IHN0cmluZyB9KTogUHJvbWlzZTxzdHJpbmdbXT4ge1xuXHRcdGNvbnN0IHsgZm9sZGVyUGF0aCB9ID0gcGFyYW1zXG5cblx0XHRpZiAoIShhd2FpdCB0aGlzLmlzRGlyZWN0b3J5KHsgZm9sZGVyUGF0aCB9KSkpIHtcblx0XHRcdHJldHVybiBbXVxuXHRcdH1cblx0XHRjb25zdCBmb2xkZXJDb250ZW50ID0gKGF3YWl0IHRoaXMuZ2V0Rm9sZGVyQ29udGVudCh7IGZvbGRlclBhdGggfSkpLm1hcCgoZm9sZGVyQ29udGVudFBhdGgpID0+IHtcblx0XHRcdHJldHVybiBgJHtmb2xkZXJQYXRofS8ke2ZvbGRlckNvbnRlbnRQYXRofWBcblx0XHR9KVxuXHRcdGNvbnN0IHN1YkZvbGRlckNvbnRlbnRzID0gYXdhaXQgUHJvbWlzZS5hbGwoXG5cdFx0XHRmb2xkZXJDb250ZW50Lm1hcCgoZm9sZGVyQ29udGVudFBhdGgpID0+IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZ2V0UmVjdXJyaW5nRm9sZGVyQ29udGVudCh7IGZvbGRlclBhdGg6IGZvbGRlckNvbnRlbnRQYXRoIH0pXG5cdFx0XHR9KVxuXHRcdClcblxuXHRcdHJldHVybiBbLi4uZm9sZGVyQ29udGVudCwgLi4uc3ViRm9sZGVyQ29udGVudHMuZmxhdCgpXVxuXHR9XG5cblx0YXN5bmMgaXNEaXJlY3RvcnkocGFyYW1zOiB7IGZvbGRlclBhdGg6IHN0cmluZyB9KTogUHJvbWlzZTxib29sZWFuPiB7XG5cdFx0Y29uc3QgeyBmb2xkZXJQYXRoIH0gPSBwYXJhbXNcblxuXHRcdHRyeSB7XG5cdFx0XHRjb25zdCBzdGF0ID0gYXdhaXQgZnMuc3RhdChmb2xkZXJQYXRoKVxuXG5cdFx0XHRyZXR1cm4gc3RhdC5pc0RpcmVjdG9yeSgpXG5cdFx0fSBjYXRjaCAoZXJyb3IpIHtcblx0XHRcdGxvZ2dlcigpLmVycm9yKCdGaWxlQ2xpZW50LmlzRGlyZWN0b3J5JywgeyBlcnJvciB9KVxuXG5cdFx0XHRyZXR1cm4gZmFsc2Vcblx0XHR9XG5cdH1cblxuXHRhc3luYyBpc0ZpbGUocGFyYW1zOiB7IGZpbGVQYXRoOiBzdHJpbmcgfSk6IFByb21pc2U8Ym9vbGVhbj4ge1xuXHRcdGNvbnN0IHsgZmlsZVBhdGggfSA9IHBhcmFtc1xuXG5cdFx0dHJ5IHtcblx0XHRcdGNvbnN0IHN0YXQgPSBhd2FpdCBmcy5zdGF0KGZpbGVQYXRoKVxuXG5cdFx0XHRyZXR1cm4gc3RhdC5pc0ZpbGUoKVxuXHRcdH0gY2F0Y2ggKGVycm9yKSB7XG5cdFx0XHRsb2dnZXIoKS5lcnJvcignRmlsZUNsaWVudC5pc0ZpbGUnLCB7IGVycm9yIH0pXG5cblx0XHRcdHJldHVybiBmYWxzZVxuXHRcdH1cblx0fVxuXG5cdGFzeW5jIG1ha2VGb2xkZXJJZk5vdEV4aXN0KHBhcmFtczogeyBmb2xkZXJQYXRoOiBzdHJpbmcgfSk6IFByb21pc2U8dm9pZD4ge1xuXHRcdGNvbnN0IHsgZm9sZGVyUGF0aCB9ID0gcGFyYW1zXG5cblx0XHRpZiAoYXdhaXQgZnMuc3RhdChmb2xkZXJQYXRoKS5jYXRjaCgoKSA9PiBmYWxzZSkpIHtcblx0XHRcdHJldHVyblxuXHRcdH1cblxuXHRcdHJldHVybiBmcy5ta2Rpcihmb2xkZXJQYXRoKVxuXHR9XG5cblx0YXN5bmMgcmVhZEZpbGUocGFyYW1zOiB7IGZpbGVQYXRoOiBzdHJpbmcgfSk6IFByb21pc2U8c3RyaW5nPiB7XG5cdFx0Y29uc3QgeyBmaWxlUGF0aCB9ID0gcGFyYW1zXG5cblx0XHRyZXR1cm4gZnMucmVhZEZpbGUoZmlsZVBhdGgsIHsgZW5jb2Rpbmc6ICd1dGYtOCcgfSlcblx0fVxuXG5cdGFzeW5jIHJlbW92ZUZpbGUocGFyYW1zOiB7IGZpbGVQYXRoOiBzdHJpbmcgfSk6IFByb21pc2U8dm9pZD4ge1xuXHRcdGNvbnN0IHsgZmlsZVBhdGggfSA9IHBhcmFtc1xuXG5cdFx0aWYgKCEoYXdhaXQgZnMuc3RhdChmaWxlUGF0aCkuY2F0Y2goKCkgPT4gZmFsc2UpKSkge1xuXHRcdFx0cmV0dXJuXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGZzLnJtKGZpbGVQYXRoKVxuXHR9XG5cblx0YXN5bmMgcmVtb3ZlRm9sZGVyKHBhcmFtczogeyBmb2xkZXJQYXRoOiBzdHJpbmcgfSk6IFByb21pc2U8dm9pZD4ge1xuXHRcdGNvbnN0IHsgZm9sZGVyUGF0aCB9ID0gcGFyYW1zXG5cblx0XHRpZiAoIShhd2FpdCBmcy5zdGF0KGZvbGRlclBhdGgpLmNhdGNoKCgpID0+IGZhbHNlKSkpIHtcblx0XHRcdHJldHVyblxuXHRcdH1cblxuXHRcdHJldHVybiBmcy5ybShmb2xkZXJQYXRoLCB7IGZvcmNlOiB0cnVlLCByZWN1cnNpdmU6IHRydWUgfSlcblx0fVxuXG5cdHdyaXRlVG9GaWxlKHBhcmFtczogeyBmaWxlUGF0aDogc3RyaW5nOyBmaWxlQ29udGVudDogc3RyaW5nIH0pOiBQcm9taXNlPHZvaWQ+IHtcblx0XHRjb25zdCB7IGZpbGVQYXRoLCBmaWxlQ29udGVudCB9ID0gcGFyYW1zXG5cblx0XHRyZXR1cm4gZnMud3JpdGVGaWxlKGZpbGVQYXRoLCBmaWxlQ29udGVudCwgJ3V0Zi04Jylcblx0fVxufVxuIl19