import extractZip from 'extract-zip';
import { promises as fs } from 'fs';
import { copy } from 'fs-extra';
import { glob } from 'glob';
import { logger } from '#src/util/logger';
export const fileService = {
    copy: async (src, dest, options = { ignore: [] }) => {
        const copyContentList = await glob('**/*', { cwd: src, dot: true, ignore: [...options.ignore, '.bfignore'], nodir: true });
        await Promise.all(copyContentList.map((file) => {
            return copy(`${src}/${file}`, `${dest}/${file}`);
        }));
    },
    copyFilesIfNotExists: async (src, dest) => {
        await copy(src, dest, { overwrite: false });
    },
    filterFiles: async (fileFolderList) => {
        const filtered = await Promise.all(fileFolderList.map(async (f) => {
            if (await fileService.isFile(f)) {
                return f;
            }
            return undefined;
        }));
        return filtered.filter(Boolean);
    },
    getFolderContent: async (path) => {
        return fs.readdir(path);
    },
    getRecurringFolderContent: async (path) => {
        if (!(await fileService.isDirectory(path))) {
            return [];
        }
        const folderContent = (await fileService.getFolderContent(path)).map((f) => `${path}/${f}`);
        const subFolderContents = await Promise.all(folderContent.map(fileService.getRecurringFolderContent));
        return [...folderContent, ...subFolderContents.flat()];
    },
    isDirectory: async (path) => {
        try {
            const stat = await fs.stat(path);
            return stat.isDirectory();
        }
        catch (e) {
            logger().error('fileService.isDirectory', { error: e });
            return false;
        }
    },
    isFile: async (path) => {
        try {
            const stat = await fs.stat(path);
            return stat.isFile();
        }
        catch (e) {
            logger().error('fileService.isFile', { error: e });
            return false;
        }
    },
    makeFolderIfNotExist: async (folderPath) => {
        if (await fs.stat(folderPath).catch(() => false)) {
            return;
        }
        await fs.mkdir(folderPath);
    },
    readFile: async (filePath) => {
        return fs.readFile(filePath, { encoding: 'utf-8' });
    },
    readIgnoreList: async (path) => {
        try {
            const body = await fileService.readFile(`${path}/.bfignore`);
            return body
                .split('\n')
                .map((v) => v.trim())
                .filter(Boolean);
        }
        catch (e) {
            logger().error('fileService.readIgnoreList', { error: e });
            return [];
        }
    },
    removeFile: async (filePath) => {
        if (!(await fs.stat(filePath).catch(() => false))) {
            return;
        }
        await fs.rm(filePath);
    },
    removeFolder: async (folderPath) => {
        if (!(await fs.stat(folderPath).catch(() => false))) {
            return;
        }
        // @ts-expect-error
        await fs.rmdir(folderPath, { force: true, recursive: true });
    },
    unzip: async (src, dest) => {
        await extractZip(src, { dir: dest });
    },
    writeToFile: async (filePath, data) => {
        await fs.writeFile(filePath, data, 'utf-8');
    },
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmlsZS1zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL3NlcnZpY2UvZmlsZS1zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sVUFBVSxNQUFNLGFBQWEsQ0FBQTtBQUNwQyxPQUFPLEVBQUUsUUFBUSxJQUFJLEVBQUUsRUFBRSxNQUFNLElBQUksQ0FBQTtBQUNuQyxPQUFPLEVBQUUsSUFBSSxFQUFFLE1BQU0sVUFBVSxDQUFBO0FBQy9CLE9BQU8sRUFBRSxJQUFJLEVBQUUsTUFBTSxNQUFNLENBQUE7QUFFM0IsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLGtCQUFrQixDQUFBO0FBRXpDLE1BQU0sQ0FBQyxNQUFNLFdBQVcsR0FBRztJQUMxQixJQUFJLEVBQUUsS0FBSyxFQUFFLEdBQVcsRUFBRSxJQUFZLEVBQUUsVUFBZ0MsRUFBRSxNQUFNLEVBQUUsRUFBRSxFQUFFLEVBQWlCLEVBQUU7UUFDeEcsTUFBTSxlQUFlLEdBQUcsTUFBTSxJQUFJLENBQUMsTUFBTSxFQUFFLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsSUFBSSxFQUFFLE1BQU0sRUFBRSxDQUFDLEdBQUcsT0FBTyxDQUFDLE1BQU0sRUFBRSxXQUFXLENBQUMsRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQTtRQUMxSCxNQUFNLE9BQU8sQ0FBQyxHQUFHLENBQ2YsZUFBdUIsQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFZLEVBQUUsRUFBRTtZQUM3QyxPQUFPLElBQUksQ0FBQyxHQUFHLEdBQUcsSUFBSSxJQUFJLEVBQUUsRUFBRSxHQUFHLElBQUksSUFBSSxJQUFJLEVBQUUsQ0FBQyxDQUFBO1FBQ2pELENBQUMsQ0FBQyxDQUNGLENBQUE7SUFDRixDQUFDO0lBQ0Qsb0JBQW9CLEVBQUUsS0FBSyxFQUFFLEdBQVcsRUFBRSxJQUFZLEVBQWlCLEVBQUU7UUFDeEUsTUFBTSxJQUFJLENBQUMsR0FBRyxF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QUFDLEVBQUUsQ0FBQztZQUNyRCxPQUFNO1FBQ1AsQ0FBQztRQUNELG1CQUFtQjtRQUNuQixNQUFNLEVBQUUsQ0FBQyxLQUFLLENBQUMsVUFBVSxFQUFFLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxTQUFTLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQTtJQUM3RCxDQUFDO0lBQ0QsS0FBSyxFQUFFLEtBQUssRUFBRSxHQUFXLEVBQUUsSUFBWSxFQUFpQixFQUFFO1FBQ3pELE1BQU0sVUFBVSxDQUFDLEdBQUcsRUFBRSxFQUFFLEdBQUcsRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFBO0lBQ3JDLENBQUM7SUFDRCxXQUFXLEVBQUUsS0FBSyxFQUFFLFFBQWdCLEVBQUUsSUFBWSxFQUFpQixFQUFFO1FBQ3BFLE1BQU0sRUFBRSxDQUFDLFNBQVMsQ0FBQyxRQUFRLEVBQUUsSUFBSSxFQUFFLE9BQU8sQ0FBQyxDQUFBO0lBQzVDLENBQUM7Q0FDRCxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGV4dHJhY3RaaXAgZnJvbSAnZXh0cmFjdC16aXAnXG5pbXBvcnQgeyBwcm9taXNlcyBhcyBmcyB9IGZyb20gJ2ZzJ1xuaW1wb3J0IHsgY29weSB9IGZyb20gJ2ZzLWV4dHJhJ1xuaW1wb3J0IHsgZ2xvYiB9IGZyb20gJ2dsb2InXG5cbmltcG9ydCB7IGxvZ2dlciB9IGZyb20gJyNzcmMvdXRpbC9sb2dnZXInXG5cbmV4cG9ydCBjb25zdCBmaWxlU2VydmljZSA9IHtcblx0Y29weTogYXN5bmMgKHNyYzogc3RyaW5nLCBkZXN0OiBzdHJpbmcsIG9wdGlvbnM6IHsgaWdub3JlOiBzdHJpbmdbXSB9ID0geyBpZ25vcmU6IFtdIH0pOiBQcm9taXNlPHZvaWQ+ID0+IHtcblx0XHRjb25zdCBjb3B5Q29udGVudExpc3QgPSBhd2FpdCBnbG9iKCcqKi8qJywgeyBjd2Q6IHNyYywgZG90OiB0cnVlLCBpZ25vcmU6IFsuLi5vcHRpb25zLmlnbm9yZSwgJy5iZmlnbm9yZSddLCBub2RpcjogdHJ1ZSB9KVxuXHRcdGF3YWl0IFByb21pc2UuYWxsKFxuXHRcdFx0KGNvcHlDb250ZW50TGlzdCBhcyBhbnkpLm1hcCgoZmlsZTogc3RyaW5nKSA9PiB7XG5cdFx0XHRcdHJldHVybiBjb3B5KGAke3NyY30vJHtmaWxlfWAsIGAke2Rlc3R9LyR7ZmlsZX1gKVxuXHRcdFx0fSlcblx0XHQpXG5cdH0sXG5cdGNvcHlGaWxlc0lmTm90RXhpc3RzOiBhc3luYyAoc3JjOiBzdHJpbmcsIGRlc3Q6IHN0cmluZyk6IFByb21pc2U8dm9pZD4gPT4ge1xuXHRcdGF3YWl0IGNvcHkoc3JjLCBkZXN0LCB7IG92ZXJ3cml0ZTogZmFsc2UgfSlcblx0fSxcblx0ZmlsdGVyRmlsZXM6IGFzeW5jIChmaWxlRm9sZGVyTGlzdDogc3RyaW5nW10pOiBQcm9taXNlPHN0cmluZ1tdPiA9PiB7XG5cdFx0Y29uc3QgZmlsdGVyZWQgPSBhd2FpdCBQcm9taXNlLmFsbChcblx0XHRcdGZpbGVGb2xkZXJMaXN0Lm1hcChhc3luYyAoZikgPT4ge1xuXHRcdFx0XHRpZiAoYXdhaXQgZmlsZVNlcnZpY2UuaXNGaWxlKGYpKSB7XG5cdFx0XHRcdFx0cmV0dXJuIGZcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiB1bmRlZmluZWRcblx0XHRcdH0pXG5cdFx0KVxuXG5cdFx0cmV0dXJuIGZpbHRlcmVkLmZpbHRlcihCb29sZWFuKSBhcyBzdHJpbmdbXVxuXHR9LFxuXHRnZXRGb2xkZXJDb250ZW50OiBhc3luYyAocGF0aDogc3RyaW5nKTogUHJvbWlzZTxzdHJpbmdbXT4gPT4ge1xuXHRcdHJldHVybiBmcy5yZWFkZGlyKHBhdGgpXG5cdH0sXG5cdGdldFJlY3VycmluZ0ZvbGRlckNvbnRlbnQ6IGFzeW5jIChwYXRoOiBzdHJpbmcpOiBQcm9taXNlPHN0cmluZ1tdPiA9PiB7XG5cdFx0aWYgKCEoYXdhaXQgZmlsZVNlcnZpY2UuaXNEaXJlY3RvcnkocGF0aCkpKSB7XG5cdFx0XHRyZXR1cm4gW11cblx0XHR9XG5cdFx0Y29uc3QgZm9sZGVyQ29udGVudCA9IChhd2FpdCBmaWxlU2VydmljZS5nZXRGb2xkZXJDb250ZW50KHBhdGgpKS5tYXAoKGYpID0+IGAke3BhdGh9LyR7Zn1gKVxuXHRcdGNvbnN0IHN1YkZvbGRlckNvbnRlbnRzID0gYXdhaXQgUHJvbWlzZS5hbGwoZm9sZGVyQ29udGVudC5tYXAoZmlsZVNlcnZpY2UuZ2V0UmVjdXJyaW5nRm9sZGVyQ29udGVudCkpXG5cblx0XHRyZXR1cm4gWy4uLmZvbGRlckNvbnRlbnQsIC4uLnN1YkZvbGRlckNvbnRlbnRzLmZsYXQoKV1cblx0fSxcblx0aXNEaXJlY3Rvcnk6IGFzeW5jIChwYXRoOiBzdHJpbmcpOiBQcm9taXNlPGJvb2xlYW4+ID0+IHtcblx0XHR0cnkge1xuXHRcdFx0Y29uc3Qgc3RhdCA9IGF3YWl0IGZzLnN0YXQocGF0aClcblxuXHRcdFx0cmV0dXJuIHN0YXQuaXNEaXJlY3RvcnkoKVxuXHRcdH0gY2F0Y2ggKGUpIHtcblx0XHRcdGxvZ2dlcigpLmVycm9yKCdmaWxlU2VydmljZS5pc0RpcmVjdG9yeScsIHsgZXJyb3I6IGUgfSlcblxuXHRcdFx0cmV0dXJuIGZhbHNlXG5cdFx0fVxuXHR9LFxuXHRpc0ZpbGU6IGFzeW5jIChwYXRoOiBzdHJpbmcpOiBQcm9taXNlPGJvb2xlYW4+ID0+IHtcblx0XHR0cnkge1xuXHRcdFx0Y29uc3Qgc3RhdCA9IGF3YWl0IGZzLnN0YXQocGF0aClcblxuXHRcdFx0cmV0dXJuIHN0YXQuaXNGaWxlKClcblx0XHR9IGNhdGNoIChlKSB7XG5cdFx0XHRsb2dnZXIoKS5lcnJvcignZmlsZVNlcnZpY2UuaXNGaWxlJywgeyBlcnJvcjogZSB9KVxuXG5cdFx0XHRyZXR1cm4gZmFsc2Vcblx0XHR9XG5cdH0sXG5cdG1ha2VGb2xkZXJJZk5vdEV4aXN0OiBhc3luYyAoZm9sZGVyUGF0aDogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiA9PiB7XG5cdFx0aWYgKGF3YWl0IGZzLnN0YXQoZm9sZGVyUGF0aCkuY2F0Y2goKCkgPT4gZmFsc2UpKSB7XG5cdFx0XHRyZXR1cm5cblx0XHR9XG5cdFx0YXdhaXQgZnMubWtkaXIoZm9sZGVyUGF0aClcblx0fSxcblx0cmVhZEZpbGU6IGFzeW5jIChmaWxlUGF0aDogc3RyaW5nKTogUHJvbWlzZTxzdHJpbmc+ID0+IHtcblx0XHRyZXR1cm4gZnMucmVhZEZpbGUoZmlsZVBhdGgsIHsgZW5jb2Rpbmc6ICd1dGYtOCcgfSlcblx0fSxcblx0cmVhZElnbm9yZUxpc3Q6IGFzeW5jIChwYXRoOiBzdHJpbmcpOiBQcm9taXNlPHN0cmluZ1tdPiA9PiB7XG5cdFx0dHJ5IHtcblx0XHRcdGNvbnN0IGJvZHkgPSBhd2FpdCBmaWxlU2VydmljZS5yZWFkRmlsZShgJHtwYXRofS8uYmZpZ25vcmVgKVxuXG5cdFx0XHRyZXR1cm4gYm9keVxuXHRcdFx0XHQuc3BsaXQoJ1xcbicpXG5cdFx0XHRcdC5tYXAoKHYpID0+IHYudHJpbSgpKVxuXHRcdFx0XHQuZmlsdGVyKEJvb2xlYW4pXG5cdFx0fSBjYXRjaCAoZSkge1xuXHRcdFx0bG9nZ2VyKCkuZXJyb3IoJ2ZpbGVTZXJ2aWNlLnJlYWRJZ25vcmVMaXN0JywgeyBlcnJvcjogZSB9KVxuXG5cdFx0XHRyZXR1cm4gW11cblx0XHR9XG5cdH0sXG5cdHJlbW92ZUZpbGU6IGFzeW5jIChmaWxlUGF0aDogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiA9PiB7XG5cdFx0aWYgKCEoYXdhaXQgZnMuc3RhdChmaWxlUGF0aCkuY2F0Y2goKCkgPT4gZmFsc2UpKSkge1xuXHRcdFx0cmV0dXJuXG5cdFx0fVxuXHRcdGF3YWl0IGZzLnJtKGZpbGVQYXRoKVxuXHR9LFxuXHRyZW1vdmVGb2xkZXI6IGFzeW5jIChmb2xkZXJQYXRoOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+ID0+IHtcblx0XHRpZiAoIShhd2FpdCBmcy5zdGF0KGZvbGRlclBhdGgpLmNhdGNoKCgpID0+IGZhbHNlKSkpIHtcblx0XHRcdHJldHVyblxuXHRcdH1cblx0XHQvLyBAdHMtZXhwZWN0LWVycm9yXG5cdFx0YXdhaXQgZnMucm1kaXIoZm9sZGVyUGF0aCwgeyBmb3JjZTogdHJ1ZSwgcmVjdXJzaXZlOiB0cnVlIH0pXG5cdH0sXG5cdHVuemlwOiBhc3luYyAoc3JjOiBzdHJpbmcsIGRlc3Q6IHN0cmluZyk6IFByb21pc2U8dm9pZD4gPT4ge1xuXHRcdGF3YWl0IGV4dHJhY3RaaXAoc3JjLCB7IGRpcjogZGVzdCB9KVxuXHR9LFxuXHR3cml0ZVRvRmlsZTogYXN5bmMgKGZpbGVQYXRoOiBzdHJpbmcsIGRhdGE6IHN0cmluZyk6IFByb21pc2U8dm9pZD4gPT4ge1xuXHRcdGF3YWl0IGZzLndyaXRlRmlsZShmaWxlUGF0aCwgZGF0YSwgJ3V0Zi04Jylcblx0fSxcbn1cbiJdfQ==