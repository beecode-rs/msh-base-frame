import extractZip from 'extract-zip';
import { promises as fs } from 'fs';
import { copy } from 'fs-extra';
import { glob } from 'glob';
import { logger } from '#src/util/logger';
export const fileService = {
    copy: async (src, dest, options = { ignore: [] }) => {
        const copyContentList = await glob('**/*', { cwd: src, dot: true, ignore: [...options.ignore, '.bfignore'], nodir: true });
        await Promise.all(
        // eslint-disable-next-line @typescript-eslint/no-explicit-any
        copyContentList.map((file) => {
            return copy(`${src}/${file}`, `${dest}/${file}`);
        }));
    },
    copyFilesIfNotExists: async (src, dest) => {
        await copy(src, dest, { overwrite: false });
    },
    filterFiles: async (fileFolderList) => {
        const filtered = await Promise.all(fileFolderList.map(async (f) => {
            if (await fileService.isFile(f)) {
                return f;
            }
            return undefined;
        }));
        return filtered.filter(Boolean);
    },
    getFolderContent: async (path) => {
        return fs.readdir(path);
    },
    getRecurringFolderContent: async (path) => {
        if (!(await fileService.isDirectory(path))) {
            return [];
        }
        const folderContent = (await fileService.getFolderContent(path)).map((f) => `${path}/${f}`);
        const subFolderContents = await Promise.all(folderContent.map(fileService.getRecurringFolderContent));
        return [...folderContent, ...subFolderContents.flat()];
    },
    isDirectory: async (path) => {
        try {
            const stat = await fs.stat(path);
            return stat.isDirectory();
        }
        catch (e) {
            logger().error('fileService.isDirectory', { error: e });
            return false;
        }
    },
    isFile: async (path) => {
        try {
            const stat = await fs.stat(path);
            return stat.isFile();
        }
        catch (e) {
            logger().error('fileService.isFile', { error: e });
            return false;
        }
    },
    makeFolderIfNotExist: async (folderPath) => {
        if (await fs.stat(folderPath).catch(() => false)) {
            return;
        }
        await fs.mkdir(folderPath);
    },
    readFile: async (filePath) => {
        return fs.readFile(filePath, { encoding: 'utf-8' });
    },
    readIgnoreList: async (path) => {
        try {
            const body = await fileService.readFile(`${path}/.bfignore`);
            return body
                .split('\n')
                .map((v) => v.trim())
                .filter(Boolean);
        }
        catch (e) {
            logger().error('fileService.readIgnoreList', { error: e });
            return [];
        }
    },
    removeFile: async (filePath) => {
        if (!(await fs.stat(filePath).catch(() => false))) {
            return;
        }
        await fs.rm(filePath);
    },
    removeFolder: async (folderPath) => {
        if (!(await fs.stat(folderPath).catch(() => false))) {
            return;
        }
        // @ts-expect-error
        await fs.rmdir(folderPath, { force: true, recursive: true });
    },
    unzip: async (src, dest) => {
        await extractZip(src, { dir: dest });
    },
    writeToFile: async (filePath, data) => {
        await fs.writeFile(filePath, data, 'utf-8');
    },
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmlsZS1zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL3NlcnZpY2UvZmlsZS1zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sVUFBVSxNQUFNLGFBQWEsQ0FBQTtBQUNwQyxPQUFPLEVBQUUsUUFBUSxJQUFJLEVBQUUsRUFBRSxNQUFNLElBQUksQ0FBQTtBQUNuQyxPQUFPLEVBQUUsSUFBSSxFQUFFLE1BQU0sVUFBVSxDQUFBO0FBQy9CLE9BQU8sRUFBRSxJQUFJLEVBQUUsTUFBTSxNQUFNLENBQUE7QUFFM0IsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLGtCQUFrQixDQUFBO0FBRXpDLE1BQU0sQ0FBQyxNQUFNLFdBQVcsR0FBRztJQUMxQixJQUFJLEVBQUUsS0FBSyxFQUFFLEdBQVcsRUFBRSxJQUFZLEVBQUUsVUFBZ0MsRUFBRSxNQUFNLEVBQUUsRUFBRSxFQUFFLEVBQWlCLEVBQUU7UUFDeEcsTUFBTSxlQUFlLEdBQUcsTUFBTSxJQUFJLENBQUMsTUFBTSxFQUFFLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsSUFBSSxFQUFFLE1BQU0sRUFBRSxDQUFDLEdBQUcsT0FBTyxDQUFDLE1BQU0sRUFBRSxXQUFXLENBQUMsRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQTtRQUMxSCxNQUFNLE9BQU8sQ0FBQyxHQUFHO1FBQ2hCLDhEQUE4RDtRQUM3RCxlQUF1QixDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQVksRUFBRSxFQUFFO1lBQzdDLE9BQU8sSUFBSSxDQUFDLEdBQUcsR0FBRyxJQUFJLElBQUksRUFBRSxFQUFFLEdBQUcsSUFBSSxJQUFJLElBQUksRUFBRSxDQUFDLENBQUE7UUFDakQsQ0FBQyxDQUFDLENBQ0YsQ0FBQTtJQUNGLENBQUM7SUFDRCxvQkFBb0IsRUFBRSxLQUFLLEVBQUUsR0FBVyxFQUFFLElBQVksRUFBaUIsRUFBRTtRQUN4RSxNQUFNLElB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QUMsS0FBSyxDQUFDLENBQUMsRUFBRSxDQUFDO1lBQ3JELE9BQU07UUFDUCxDQUFDO1FBQ0QsbUJBQW1CO1FBQ25CLE1BQU0sRUFBRSxDQUFDLEtBQUssQ0FBQyxVQUFVLEVBQUUsRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLFNBQVMsRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFBO0lBQzdELENBQUM7SUFDRCxLQUFLLEVBQUUsS0FBSyxFQUFFLEdBQVcsRUFBRSxJQUFZLEVBQWlCLEVBQUU7UUFDekQsTUFBTSxVQUFVLENBQUMsR0FBRyxFQUFFLEVBQUUsR0FBRyxFQUFFLElBQUksRUFBRSxDQUFDLENBQUE7SUFDckMsQ0FBQztJQUNELFdBQVcsRUFBRSxLQUFLLEVBQUUsUUFBZ0IsRUFBRSxJQUFZLEVBQWlCLEVBQUU7UUFDcEUsTUFBTSxFQUFFLENBQUMsU0FBUyxDQUFDLFFBQVEsRUFBRSxJQUFJLEVBQUUsT0FBTyxDQUFDLENBQUE7SUFDNUMsQ0FBQztDQUNELENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgZXh0cmFjdFppcCBmcm9tICdleHRyYWN0LXppcCdcbmltcG9ydCB7IHByb21pc2VzIGFzIGZzIH0gZnJvbSAnZnMnXG5pbXBvcnQgeyBjb3B5IH0gZnJvbSAnZnMtZXh0cmEnXG5pbXBvcnQgeyBnbG9iIH0gZnJvbSAnZ2xvYidcblxuaW1wb3J0IHsgbG9nZ2VyIH0gZnJvbSAnI3NyYy91dGlsL2xvZ2dlcidcblxuZXhwb3J0IGNvbnN0IGZpbGVTZXJ2aWNlID0ge1xuXHRjb3B5OiBhc3luYyAoc3JjOiBzdHJpbmcsIGRlc3Q6IHN0cmluZywgb3B0aW9uczogeyBpZ25vcmU6IHN0cmluZ1tdIH0gPSB7IGlnbm9yZTogW10gfSk6IFByb21pc2U8dm9pZD4gPT4ge1xuXHRcdGNvbnN0IGNvcHlDb250ZW50TGlzdCA9IGF3YWl0IGdsb2IoJyoqLyonLCB7IGN3ZDogc3JjLCBkb3Q6IHRydWUsIGlnbm9yZTogWy4uLm9wdGlvbnMuaWdub3JlLCAnLmJmaWdub3JlJ10sIG5vZGlyOiB0cnVlIH0pXG5cdFx0YXdhaXQgUHJvbWlzZS5hbGwoXG5cdFx0XHQvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxuXHRcdFx0KGNvcHlDb250ZW50TGlzdCBhcyBhbnkpLm1hcCgoZmlsZTogc3RyaW5nKSA9PiB7XG5cdFx0XHRcdHJldHVybiBjb3B5KGAke3NyY30vJHtmaWxlfWAsIGAke2Rlc3R9LyR7ZmlsZX1gKVxuXHRcdFx0fSlcblx0XHQpXG5cdH0sXG5cdGNvcHlGaWxlc0lmTm90RXhpc3RzOiBhc3luYyAoc3JjOiBzdHJpbmcsIGRlc3Q6IHN0cmluZyk6IFByb21pc2U8dm9pZD4gPT4ge1xuXHRcdGF3YWl0IGNvcHkoc3JjLCBkZXN0LCB7IG92ZXJ3cml0ZTogZmFsc2UgfSlcblx0fSxcblx0ZmlsdGVyRmlsZXM6IGFzeW5jIChmaWxlRm9sZGVyTGlzdDogc3RyaW5nW10pOiBQcm9taXNlPHN0cmluZ1tdPiA9PiB7XG5cdFx0Y29uc3QgZmlsdGVyZWQgPSBhd2FpdCBQcm9taXNlLmFsbChcblx0XHRcdGZpbGVGb2xkZXJMaXN0Lm1hcChhc3luYyAoZikgPT4ge1xuXHRcdFx0XHRpZiAoYXdhaXQgZmlsZVNlcnZpY2UuaXNGaWxlKGYpKSB7XG5cdFx0XHRcdFx0cmV0dXJuIGZcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiB1bmRlZmluZWRcblx0XHRcdH0pXG5cdFx0KVxuXG5cdFx0cmV0dXJuIGZpbHRlcmVkLmZpbHRlcihCb29sZWFuKSBhcyBzdHJpbmdbXVxuXHR9LFxuXHRnZXRGb2xkZXJDb250ZW50OiBhc3luYyAocGF0aDogc3RyaW5nKTogUHJvbWlzZTxzdHJpbmdbXT4gPT4ge1xuXHRcdHJldHVybiBmcy5yZWFkZGlyKHBhdGgpXG5cdH0sXG5cdGdldFJlY3VycmluZ0ZvbGRlckNvbnRlbnQ6IGFzeW5jIChwYXRoOiBzdHJpbmcpOiBQcm9taXNlPHN0cmluZ1tdPiA9PiB7XG5cdFx0aWYgKCEoYXdhaXQgZmlsZVNlcnZpY2UuaXNEaXJlY3RvcnkocGF0aCkpKSB7XG5cdFx0XHRyZXR1cm4gW11cblx0XHR9XG5cdFx0Y29uc3QgZm9sZGVyQ29udGVudCA9IChhd2FpdCBmaWxlU2VydmljZS5nZXRGb2xkZXJDb250ZW50KHBhdGgpKS5tYXAoKGYpID0+IGAke3BhdGh9LyR7Zn1gKVxuXHRcdGNvbnN0IHN1YkZvbGRlckNvbnRlbnRzID0gYXdhaXQgUHJvbWlzZS5hbGwoZm9sZGVyQ29udGVudC5tYXAoZmlsZVNlcnZpY2UuZ2V0UmVjdXJyaW5nRm9sZGVyQ29udGVudCkpXG5cblx0XHRyZXR1cm4gWy4uLmZvbGRlckNvbnRlbnQsIC4uLnN1YkZvbGRlckNvbnRlbnRzLmZsYXQoKV1cblx0fSxcblx0aXNEaXJlY3Rvcnk6IGFzeW5jIChwYXRoOiBzdHJpbmcpOiBQcm9taXNlPGJvb2xlYW4+ID0+IHtcblx0XHR0cnkge1xuXHRcdFx0Y29uc3Qgc3RhdCA9IGF3YWl0IGZzLnN0YXQocGF0aClcblxuXHRcdFx0cmV0dXJuIHN0YXQuaXNEaXJlY3RvcnkoKVxuXHRcdH0gY2F0Y2ggKGUpIHtcblx0XHRcdGxvZ2dlcigpLmVycm9yKCdmaWxlU2VydmljZS5pc0RpcmVjdG9yeScsIHsgZXJyb3I6IGUgfSlcblxuXHRcdFx0cmV0dXJuIGZhbHNlXG5cdFx0fVxuXHR9LFxuXHRpc0ZpbGU6IGFzeW5jIChwYXRoOiBzdHJpbmcpOiBQcm9taXNlPGJvb2xlYW4+ID0+IHtcblx0XHR0cnkge1xuXHRcdFx0Y29uc3Qgc3RhdCA9IGF3YWl0IGZzLnN0YXQocGF0aClcblxuXHRcdFx0cmV0dXJuIHN0YXQuaXNGaWxlKClcblx0XHR9IGNhdGNoIChlKSB7XG5cdFx0XHRsb2dnZXIoKS5lcnJvcignZmlsZVNlcnZpY2UuaXNGaWxlJywgeyBlcnJvcjogZSB9KVxuXG5cdFx0XHRyZXR1cm4gZmFsc2Vcblx0XHR9XG5cdH0sXG5cdG1ha2VGb2xkZXJJZk5vdEV4aXN0OiBhc3luYyAoZm9sZGVyUGF0aDogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiA9PiB7XG5cdFx0aWYgKGF3YWl0IGZzLnN0YXQoZm9sZGVyUGF0aCkuY2F0Y2goKCkgPT4gZmFsc2UpKSB7XG5cdFx0XHRyZXR1cm5cblx0XHR9XG5cdFx0YXdhaXQgZnMubWtkaXIoZm9sZGVyUGF0aClcblx0fSxcblx0cmVhZEZpbGU6IGFzeW5jIChmaWxlUGF0aDogc3RyaW5nKTogUHJvbWlzZTxzdHJpbmc+ID0+IHtcblx0XHRyZXR1cm4gZnMucmVhZEZpbGUoZmlsZVBhdGgsIHsgZW5jb2Rpbmc6ICd1dGYtOCcgfSlcblx0fSxcblx0cmVhZElnbm9yZUxpc3Q6IGFzeW5jIChwYXRoOiBzdHJpbmcpOiBQcm9taXNlPHN0cmluZ1tdPiA9PiB7XG5cdFx0dHJ5IHtcblx0XHRcdGNvbnN0IGJvZHkgPSBhd2FpdCBmaWxlU2VydmljZS5yZWFkRmlsZShgJHtwYXRofS8uYmZpZ25vcmVgKVxuXG5cdFx0XHRyZXR1cm4gYm9keVxuXHRcdFx0XHQuc3BsaXQoJ1xcbicpXG5cdFx0XHRcdC5tYXAoKHYpID0+IHYudHJpbSgpKVxuXHRcdFx0XHQuZmlsdGVyKEJvb2xlYW4pXG5cdFx0fSBjYXRjaCAoZSkge1xuXHRcdFx0bG9nZ2VyKCkuZXJyb3IoJ2ZpbGVTZXJ2aWNlLnJlYWRJZ25vcmVMaXN0JywgeyBlcnJvcjogZSB9KVxuXG5cdFx0XHRyZXR1cm4gW11cblx0XHR9XG5cdH0sXG5cdHJlbW92ZUZpbGU6IGFzeW5jIChmaWxlUGF0aDogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiA9PiB7XG5cdFx0aWYgKCEoYXdhaXQgZnMuc3RhdChmaWxlUGF0aCkuY2F0Y2goKCkgPT4gZmFsc2UpKSkge1xuXHRcdFx0cmV0dXJuXG5cdFx0fVxuXHRcdGF3YWl0IGZzLnJtKGZpbGVQYXRoKVxuXHR9LFxuXHRyZW1vdmVGb2xkZXI6IGFzeW5jIChmb2xkZXJQYXRoOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+ID0+IHtcblx0XHRpZiAoIShhd2FpdCBmcy5zdGF0KGZvbGRlclBhdGgpLmNhdGNoKCgpID0+IGZhbHNlKSkpIHtcblx0XHRcdHJldHVyblxuXHRcdH1cblx0XHQvLyBAdHMtZXhwZWN0LWVycm9yXG5cdFx0YXdhaXQgZnMucm1kaXIoZm9sZGVyUGF0aCwgeyBmb3JjZTogdHJ1ZSwgcmVjdXJzaXZlOiB0cnVlIH0pXG5cdH0sXG5cdHVuemlwOiBhc3luYyAoc3JjOiBzdHJpbmcsIGRlc3Q6IHN0cmluZyk6IFByb21pc2U8dm9pZD4gPT4ge1xuXHRcdGF3YWl0IGV4dHJhY3RaaXAoc3JjLCB7IGRpcjogZGVzdCB9KVxuXHR9LFxuXHR3cml0ZVRvRmlsZTogYXN5bmMgKGZpbGVQYXRoOiBzdHJpbmcsIGRhdGE6IHN0cmluZyk6IFByb21pc2U8dm9pZD4gPT4ge1xuXHRcdGF3YWl0IGZzLndyaXRlRmlsZShmaWxlUGF0aCwgZGF0YSwgJ3V0Zi04Jylcblx0fSxcbn1cbiJdfQ==